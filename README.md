# database-group-project
### 用户登录

本教学管理系统账号分为教师和学生账号两类，其中部分教师拥有管理员权限。不同的账号类型拥有不同的权限，分别允许对数据库进行不同的操作。在主页面有教师登录和学生登录两个入口用于不同账号的登录。

登录操作由view.py中的函数来完成，以教师登录为例，学生登录基本类似，大致思路如下：

* 1.首先读取用户输入的职工号和密码，判断是否为空，如果为空，返回给前端的信息设置为：'请填写职工号与密码！'，跳转至5；
* 2.根据职工号在数据库中进行检索，如果没有找到，返回给前端的信息设置为：'职工号不正确！'，跳转至5；
* 3.找到对应的职工号后，把用户输入的密码的哈希值与数据库中记录的密码的哈希值进行比对，如果不正确，返回给前端的信息设置为：'密码不正确！'，跳转至5；
* 4.完成身份认证，向服务器中的session写入身份信息：登录状态设为已登陆，账号类型设为教师，并记录其职工号。在之后对数据库进行操作时便可根据session的信息判断用户是否有权限执行。登录流程结束，显示教师的管理主页。
* 5.登录失败，前端重新渲染登录界面，显示返回的登录错误信息。

当非教师用户或未登录用户尝试直接访问教师主页时，还需要阻止其访问，所以views.py中还要增加对应的函数IndexForTeacher来进行处理。当对主页进行访问时，无论是否登录都对session中的内容进行检查，如果session中记录的账号信息没有权限访问，同样重定向到教师登录页面。对学生主页的访问控制同理。

当用户注销登录的账号时，只要将session中的信息全部清空，然后重定向到登录页面即可。

### 班级管理

本系统中班级的信息包括班级号（作为主键），班级名、建班日期、班主任（参照教师表）、所属年级（年份）、所属专业（参照专业表）。对班级表所有学生或老师都可以查询，但只有本班的班主任可以进行修改。管理员账号还可以增加、删除班级。

无论对该表进行什么操作，系统都首先检查用户的权限。权限检查通过读取session中的登录信息来实现。

* #### 查询

  查询操作返回数据库中所有的所有班级信息，并显示在前端页面上。

* #### 增加

  增加操作需要用户在前端页面中输入新的班级信息。其中班级号作为主键不能重复、班主任、所属专业必须是教师表和专业表中存在的，否则数据将被判定为无效，系统将返回信息请求用户对输入数据进行检查。判定数据合法后系统将写入到数据库中并刷新页面。

* #### 修改

  修改操作需要用户选择需要修改的班级信息，点击对应条目中的modify按钮，之后再在下方填入修改后的信息。主键将不允许被修改，其他信息如果参照了其他表则需要填写其他表中存在的项，否则将被系统阻止并请求用户检查输入数据。检查通过后系统将写入到数据库中并刷新页面。

* #### 删除

  删除操作同样需要点击对应条目的delete按钮，如果该项目存在关联信息，例如班级中还有学生，则不允许删除，系统返回信息进行提示。